@startuml
|MeshComponent|
start
:load;
:init;
fork 
	while (program running) is (new message)
	:OnRosMsg;
    if(msg.forward == This.NodeID) then([true])
    	:processMessage(msg);
    else([false])
    	:forwardMessage(msg);
	endif
	:proofOfLive(msg.from,msg.sender);
    endwhile ([false])
fork again
	while (program running) is ([30 seconds passed])
	:CheckConnection;
    if(on) then ([false])
    :connectedToGateway\n\t = false;
    else ([true])
    :SendHeartbeatToEachChild;
    :searchOtherNodesInRange;
    if(connectedToGateway) then([true])
    :sendHeartbeatToGateway;
    	if(knowGatewayLocation) then ([false])
        :requestLocation(gateway);
        endif
    else ([false])
    :lostConnection;
    endif
    endif
    endwhile ([false])
fork again
	while (program running) is ([1 second passed])
	:PublishDebugInfo;
    endwhile ([false]) 
end fork 
stop
@enduml