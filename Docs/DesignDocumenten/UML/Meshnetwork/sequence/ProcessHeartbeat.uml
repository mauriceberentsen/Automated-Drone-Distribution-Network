@startuml
autonumber
participant ":MeshGateway" as 1
participant ":MeshCommunicator" as 2
participant ":MeshCommunicator" as 0

1 --> 2 ++: SendHeartbeat(this->nodeID) : bool\n<<Wireless Signal Simulation>>
	2->2 ++:ProcessMessage(_msg)	
	2->2 ++:ProcessHeartbeat(_msg)
    2->":HeartbeatMessage" ** : <<create>>\nmsg =HeartbeatMessage(_msg.payload)
    
	alt msg.getIsGateway()
    	2->2 : prefferedGateWay = msg.getPrefferedGateway
  		2->2 : connectedToGateway = true
  		2->2 : hopsFromGatewayAway = msg.hops + 1
    	   
    else !msg.getKnowGateway( )\n && this->connectedToGateway
    	2--> 0 : sendHeartbeat\n( msg.getID);
    else msg.getKnowGateway( )\n && !this->connectedToGateway
    	2-> 2 : nodeTable.proofOfAvailability( msg.getID, msg.getPrefferedGateway )
        2-> 2 : prefferedGateWay = msg.getPrefferedGateway
        2--> 1 : sendHeartbeatToGateway
    end
    return
  return 
  2->2 : nodeTable.proofOfAvailability( _msg->from, _msg->payload[0] )
  deactivate

@enduml