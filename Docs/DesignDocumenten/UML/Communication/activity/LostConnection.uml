@startuml
|MeshnetworkRouter|

start

:lostConnection;
if (connectedToGateway) then ([true])
	:timerStarted = false;
    stop
else ([false])
	if(timerStarted) then ([true])
		if (lastTimeOnline < currentTime - waitTime) then ([true])
			:StartEmergencyProtocol;
			:timerStarted = false;
			else ([false])
		endif
    else ([false])
    	|IRoutingTechnique|
		:Remove gateway from \nknown connections;
		|MeshnetworkRouter|		
       	:Inform others about \nlost connection;
		:Save time noticed offline;
        :Start Timer;
    endif
endif
stop
@enduml