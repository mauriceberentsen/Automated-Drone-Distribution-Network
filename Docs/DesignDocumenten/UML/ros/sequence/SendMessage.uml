@startuml
autonumber
participant "communication:VirtualNRF24" as 1
participant "publishService:WirelessSignalSimulator" as SS
note over SS: Service that simulates wireless communication
participant "Node 2:MeshComponent" as 2


[-> 1  : SendHeartbeat(other = 2) : bool



alt SignalSimulator available
1 -> SS ++ : send_message(WM) : bool
SS -> SS : from = Network.find(WM.request.message.from) : iterator <<uint8_t, Node>>
SS -> SS : to = Network.find(WM.request.message.to) : iterator <<uint8_t, Node>>

alt from != Network.end( ) && to != Network.end( )
	alt !from->second->on  || !to->second->on 
		SS <- SS :	response.succes = false
    else
    	SS -> SS : distance  = \n from->second->getPosition( ).Distance( to->second->getPosition( ) )
        alt distance < maximum communication distance
        	SS -> SS ++ : to->second->recieveMessage( req.message );
            SS --> 2 --:  OnRosMsg (req.message)
        	SS <- SS :	response.succes = true
		else
        	SS <- SS :	response.succes = false
		end
    end
  else
  SS <- SS :	response.succes = false    

end

1 <- SS --: <<Response>>

alt  response.succes == false
1 -> 1 :  informAboutMissingchild (NodeID, other)
[<- 1 : False
else
[<- 1 : True

end

else SignalSimulator not available
1 -> 1 : ROS_ERROR( "SIGNAL SIMULATOR NOT AVAILABLE" )
[<- 1 : False

end
deactivate 1
@enduml